<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <meta http-equiv="X-UA-Compatible" content="chrome=1">
        <meta name="description" content="Login and Pay with Amazon SDK Samples : Login and Pay with Amazon SDK Sample Code">

        <script type="text/javascript">
            var host = "amzn.github.io";
            if ((host === window.location.host) && (window.location.protocol !== "https:"))
                window.location.protocol = "https";
        </script>
        <script type='text/javascript' src='https://static-na.payments-amazon.com/OffAmazonPayments/us/sandbox/js/Widgets.js'></script>

        <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
        <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
        <script type="text/javascript" src="javascripts/prism.js"></script>
        <script type="text/javascript" src="javascripts/floater.js"></script>
        <script type="text/javascript" src="javascripts/analytics.js"></script>

        <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/reset.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/0.0.1/prism.min.css">
        <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/prism.css">
        <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/font-mfizz.css">
        <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

        <script type="text/javascript">
            $(document).ready(function () {
                function getURLParameter(name, source) {
                    return decodeURIComponent((new RegExp('[?|&|#]' + name + '=' +
                            '([^&;]+?)(&|#|;|$)').exec(source) || [, ""])[1].replace(/\+/g, '%20')) || null;
                }
                $("#access_token").val(getURLParameter("access_token", location.hash));
            });
        </script>


        <title>Login and Pay with Amazon SDK Samples</title>
    </head>

    <body>
        <div id='floater'>
            <div class='float-icon float-lang-php'><i class="step icon-php"></i></div>
            <div class='float-icon float-lang-python'><i class="step icon-python"></i></div>
            <div class='float-icon float-lang-ruby'><i class="step icon-ruby"></i></div>
        </div>

        <!-- HEADER -->
        <div id="header_wrap" class="outer">
            <header class="inner">
                <a id="forkme_banner" href="https://github.com/amzn/">View on GitHub</a>

                <h1 id="project_title" style="margin-top:20px;">Pay with Amazon SDK Samples</h1>
                <h2 id="project_tagline">Pay with Amazon Simple Checkout</h2>


            </header>
        </div>

        <input type="hidden" id="access_token" value="" />

        <div id="main_content_wrap" class="outer"> <!-- wrap -->
            <section id="main_content" class="inner">

                <div id="section-content" style="margin-bottom:-30px">
                    <h2>Confirm</h2>
                    <p>At this point we will make the <em>Confirm</em> API call to confirm the order
                        reference and a subsequesnt <em>Authorize</em> and <em>Capture</em> API call.</p>
                    <p>This concludes the simple checkout example. Click <a onclick='startOver();' href='#'>here</a> to start over.</p>
                    <div class="alert alert-info" style="padding:10px">
                      If you have not registered for Login and Pay with Amazon click <a target="blank" href="https://payments.amazon.com/signup">here</a>. <br>
                      To access our integration guides and all available SDKs click <a target="blank" href="https://payments.amazon.com/documentation">here</a>.
                    </div>
                </div>
            </section>
            <section class="inner">
                <h2>Code</h2>
                <p>Here you can see how we made the <em>Confirm</em> and <em>Authorize</em> calls. The API calls below will use the same client instantiated on the previous page. </p>
                <div class="l-python well well-sm">Click here to see the <a target="blank" href="https://github.com/amzn/login-and-pay-with-amazon-sdk-python">Python</a> SDK.</div>
                <div class="l-ruby well well-sm">Click here to see the <a target="blank" href="https://github.com/amzn/login-and-pay-with-amazon-sdk-ruby">Ruby</a> SDK.</div>
                <div class="l-php well well-sm">Click here to see the <a  target="blank" href="https://github.com/amzn/login-and-pay-with-amazon-sdk-php">PHP</a> SDK.</div>
                <pre class="l-python"><code class="language-python">
pretty_confirm = None
pretty_authorize = None

response = client.confirm_order_reference(
    amazon_order_reference_id= 'AMAZON_ORDER_REFERENCE_ID')

pretty_confirm = json.dumps(
    json.loads(
        response.to_json()),
    indent=4)

if response.success:
    response = client.authorize(
        amazon_order_reference_id= 'AMAZON_ORDER_REFERENCE_ID',
        authorization_reference_id=rand(),
        authorization_amount=&#x27;175.00&#x27;,
        transaction_timeout=0,
        capture_now=True)

pretty_authorize = json.dumps(
    json.loads(
        response.to_json()),
    indent=4)

return render_template(
    &#x27;confirm.html&#x27;, confirm=pretty_confirm, authorize=pretty_authorize)</code></pre>


                <pre class="l-php"><code class="language-php">namespace PayWithAmazon;

session_start();

// Create the parameters array
$requestParameters = array();

// Refer to GetDetails.php where the Amazon Order Reference ID was set
$requestParameters['amazon_order_reference_id'] = 'AMAZON_ORDER_REFERENCE_ID';

// Confirm the order by making the ConfirmOrderReference API call
$response = $client->confirmOrderReference($requestParameters);

$responsearray['confirm'] = json_decode($response->toJson());

// If the API call was a success make the Authorize (with Capture) API call
if($client->success)
{
    $requestParameters['authorization_amount'] = '175.00';
    $requestParameters['authorization_reference_id'] = uniqid('A01_REF_');
    $requestParameters['seller_Authorization_Note'] = 'Authorizing and capturing the payment';
    $requestParameters['transaction_timeout'] = 0;
    $requestParameters['capture_now'] = true;

    $response = $client->authorize($requestParameters);
    $responsearray['authorize'] = json_decode($response->toJson());
}

// Echo the Json encoded array for the Ajax success
echo json_encode($responsearray);</code></pre>

                <pre class="l-ruby"><code class="language-ruby">
amazon_order_reference_id = 'AMAZON_ORDER_REFERENCE_ID'

response = client.confirm_order_reference(
    amazon_order_reference_id)

respons_hash = Hash.from_xml(response.body)
return response_hash

authorization_reference_id = "Your Unique Reference Id"
amount = '175.00'

if response.success
    response = client.authorize(
        amazon_order_reference_id,
        authorization_reference_id,
        amount,
        transaction_timeout: 0,
        capture_now: true)
end

respons_hash = Hash.from_xml(response.body)
return response_hash</code></pre>

                <p>The <em>Confirm</em> API call does not return any special values. If it were
                    unsuccessful you would see an error response.</p>
                <pre><code class="language-markup">{
    &#34;ConfirmOrderReferenceResponse&#34;: {
        &#34;ResponseMetadata&#34;: {
            &#34;RequestId&#34;: &#34;5f0ec610-a415-4299-8665-ec407e80bb83&#34;
        }
    }
}</code></pre>

                <p>The <em>Authorize</em> API call will authorize the order reference. Instead
                    of making a separate <em>Capture</em> API call we can set the <strong>CaptureNow</strong>
                    parameter to <strong>True</strong> and the funds will be captured in the same call.</p>
                <pre><code class="language-markup">{
    &#34;AuthorizeResponse&#34;: {
        &#34;ResponseMetadata&#34;: {
            &#34;RequestId&#34;: &#34;c8e2aab0-5670-43a8-b477-eace0300988a&#34;
        },
        &#34;AuthorizeResult&#34;: {
            &#34;AuthorizationDetails&#34;: {
                &#34;AmazonAuthorizationId&#34;: &#34;S01-0412594-3843978-A024491&#34;,
                &#34;SellerAuthorizationNote&#34;: null,
                &#34;CapturedAmount&#34;: {
                    &#34;Amount&#34;: &#34;0&#34;,
                    &#34;CurrencyCode&#34;: &#34;USD&#34;
                },
                &#34;AuthorizationReferenceId&#34;: &#34;2142&#34;,
                &#34;CreationTimestamp&#34;: &#34;2015-04-23T19:28:29.184Z&#34;,
                &#34;IdList&#34;: {
                    &#34;member&#34;: &#34;S01-0412594-3843978-C024491&#34;
                },
                &#34;CaptureNow&#34;: &#34;true&#34;,
                &#34;SoftDescriptor&#34;: &#34;AMZ*test&#34;,
                &#34;ExpirationTimestamp&#34;: &#34;2015-05-23T19:28:29.184Z&#34;,
                &#34;AuthorizationFee&#34;: {
                    &#34;Amount&#34;: &#34;0.00&#34;,
                    &#34;CurrencyCode&#34;: &#34;USD&#34;
                },
                &#34;AuthorizationStatus&#34;: {
                    &#34;ReasonCode&#34;: &#34;MaxCapturesProcessed&#34;,
                    &#34;LastUpdateTimestamp&#34;: &#34;2015-04-23T19:28:29.184Z&#34;,
                    &#34;State&#34;: &#34;Closed&#34;
                },
                &#34;AuthorizationAmount&#34;: {
                    &#34;Amount&#34;: &#34;175.00&#34;,
                    &#34;CurrencyCode&#34;: &#34;USD&#34;
                }
            }
        }
    }
}</code></pre>
            </section>

        </div><!-- end wrap -->

        <!-- FOOTER  -->
        <div id="footer_wrap" class="outer">
            <footer class="inner">
                <p class="copyright">Login and Pay with Amazon SDK Samples maintained by <a href="https://github.com/amzn">amzn</a></p>
                <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
            </footer>
        </div>
